import{a as R,k as C,l as B,m as x,n as M,o as q,p as G,s as k,u as F,v as _}from"./chunk-2EQR4G4G.js";import{getMultipartBoundary as Q,parseMultipartStream as J}from"@mjackson/multipart-parser";import{fileURLToPath as j}from"url";import{stripIndent as f}from"common-tags";function L(p,o=100){switch(p){case"api":return f`
        select id, identifier, timestamp, event_message, request.method, request.path, response.status_code
        from edge_logs
        cross join unnest(metadata) as m
        cross join unnest(m.request) as request
        cross join unnest(m.response) as response
        order by timestamp desc
        limit ${o}
      `;case"branch-action":return f`
        select workflow_run, workflow_run_logs.timestamp, id, event_message from workflow_run_logs
        order by timestamp desc
        limit ${o}
      `;case"postgres":return f`
        select identifier, postgres_logs.timestamp, id, event_message, parsed.error_severity from postgres_logs
        cross join unnest(metadata) as m
        cross join unnest(m.parsed) as parsed
        order by timestamp desc
        limit ${o}
      `;case"edge-function":return f`
        select id, function_edge_logs.timestamp, event_message, response.status_code, request.method, m.function_id, m.execution_time_ms, m.deployment_id, m.version from function_edge_logs
        cross join unnest(metadata) as m
        cross join unnest(m.response) as response
        cross join unnest(m.request) as request
        order by timestamp desc
        limit ${o}
      `;case"auth":return f`
        select id, auth_logs.timestamp, event_message, metadata.level, metadata.status, metadata.path, metadata.msg as msg, metadata.error from auth_logs
        cross join unnest(metadata) as metadata
        order by timestamp desc
        limit ${o}
      `;case"storage":return f`
        select id, storage_logs.timestamp, event_message from storage_logs
        order by timestamp desc
        limit ${o}
      `;case"realtime":return f`
        select id, realtime_logs.timestamp, event_message from realtime_logs
        order by timestamp desc
        limit ${o}
      `;default:throw new Error(`unsupported log service type: ${p}`)}}import U from"openapi-fetch";import{z as D}from"zod";function P(p,o,d={}){return U({baseUrl:p,headers:{Authorization:`Bearer ${o}`,...d}})}var H=D.object({message:D.string()});function r(p,o){if("error"in p){if(p.response.status===401)throw new Error("Unauthorized. Please provide a valid access token to the MCP server via the --access-token flag or SUPABASE_ACCESS_TOKEN.");let{data:d}=H.safeParse(p.error);throw d?new Error(d.message):new Error(o)}}var I="ABCDEFGHIJKLMNOPQRSTUVWXYZ",N="abcdefghijklmnopqrstuvwxyz",W="0123456789",K="!@#$%^&*()_+~`|}{[]:;?><,./-=",$=({length:p=10,numbers:o=!1,symbols:d=!1,uppercase:w=!0,lowercase:s=!0}={})=>{let m="";if(w&&(m+=I),s&&(m+=N),o&&(m+=W),d&&(m+=K),m.length===0)throw new Error("at least one character set must be selected");let O=new Uint32Array(p);crypto.getRandomValues(O);let E="";for(let v=0;v<p;v++){let S=O[v]%m.length;E+=m.charAt(S)}return E};var{version:V}=R;function fe(p){let{accessToken:o,apiUrl:d}=p,w=d??"https://api.supabase.com",s=P(w,o),m={async listOrganizations(){let t=await s.GET("/v1/organizations");return r(t,"Failed to fetch organizations"),t.data},async getOrganization(t){let e=await s.GET("/v1/organizations/{slug}",{params:{path:{slug:t}}});return r(e,"Failed to fetch organization"),e.data},async listProjects(){let t=await s.GET("/v1/projects");return r(t,"Failed to fetch projects"),t.data},async getProject(t){let e=await s.GET("/v1/projects/{ref}",{params:{path:{ref:t}}});return r(e,"Failed to fetch project"),e.data},async createProject(t){let{name:e,organization_id:a,region:n,db_pass:i}=C.parse(t),c=await s.POST("/v1/projects",{body:{name:e,region:n,organization_id:a,db_pass:i??$({length:16,numbers:!0,uppercase:!0,lowercase:!0})}});return r(c,"Failed to create project"),c.data},async pauseProject(t){let e=await s.POST("/v1/projects/{ref}/pause",{params:{path:{ref:t}}});r(e,"Failed to pause project")},async restoreProject(t){let e=await s.POST("/v1/projects/{ref}/restore",{params:{path:{ref:t}}});r(e,"Failed to restore project")}},O={async executeSql(t,e){let{query:a,parameters:n,read_only:i}=q.parse(e),c=await s.POST("/v1/projects/{ref}/database/query",{params:{path:{ref:t}},body:{query:a,parameters:n,read_only:i}});return r(c,"Failed to execute SQL query"),c.data},async listMigrations(t){let e=await s.GET("/v1/projects/{ref}/database/migrations",{params:{path:{ref:t}}});return r(e,"Failed to fetch migrations"),e.data},async applyMigration(t,e){let{name:a,query:n}=G.parse(e),i=await s.POST("/v1/projects/{ref}/database/migrations",{params:{path:{ref:t}},body:{name:a,query:n}});r(i,"Failed to apply migration")}},E={async getLogs(t,e){let{service:a,iso_timestamp_start:n,iso_timestamp_end:i}=k.parse(e),c=L(a),u=await s.GET("/v1/projects/{ref}/analytics/endpoints/logs.all",{params:{path:{ref:t},query:{sql:c,iso_timestamp_start:n,iso_timestamp_end:i}}});return r(u,"Failed to fetch logs"),u.data},async getSecurityAdvisors(t){let e=await s.GET("/v1/projects/{ref}/advisors/security",{params:{path:{ref:t}}});return r(e,"Failed to fetch security advisors"),e.data},async getPerformanceAdvisors(t){let e=await s.GET("/v1/projects/{ref}/advisors/performance",{params:{path:{ref:t}}});return r(e,"Failed to fetch performance advisors"),e.data}},v={async getProjectUrl(t){let e=new URL(w);return`https://${t}.${Y(e.hostname)}`},async getAnonKey(t){let e=await s.GET("/v1/projects/{ref}/api-keys",{params:{path:{ref:t},query:{reveal:!1}}});r(e,"Failed to fetch API keys");let a=e.data?.find(n=>n.name==="anon");if(!a?.api_key)throw new Error("Anonymous key not found");return a.api_key},async generateTypescriptTypes(t){let e=await s.GET("/v1/projects/{ref}/types/typescript",{params:{path:{ref:t}}});return r(e,"Failed to fetch TypeScript types"),e.data}},S={async listEdgeFunctions(t){let e=await s.GET("/v1/projects/{ref}/functions",{params:{path:{ref:t}}});return r(e,"Failed to fetch Edge Functions"),e.data.map(a=>{let n=F(t,a.id,a.version),i=a.entrypoint_path?_({deploymentId:n,filename:j(a.entrypoint_path,{windows:!1})}):void 0,c=a.import_map_path?_({deploymentId:n,filename:j(a.import_map_path,{windows:!1})}):void 0;return{...a,entrypoint_path:i,import_map_path:c}})},async getEdgeFunction(t,e){let a=await s.GET("/v1/projects/{ref}/functions/{function_slug}",{params:{path:{ref:t,function_slug:e}}});if(a.error)throw a.error;r(a,"Failed to fetch Edge Function");let n=a.data,i=F(t,n.id,n.version),c=n.entrypoint_path?_({deploymentId:i,filename:j(n.entrypoint_path,{windows:!1})}):void 0,u=n.import_map_path?_({deploymentId:i,filename:j(n.import_map_path,{windows:!1})}):void 0,y=await s.GET("/v1/projects/{ref}/functions/{function_slug}/body",{params:{path:{ref:t,function_slug:e}},headers:{Accept:"multipart/form-data"},parseAs:"stream"});r(y,"Failed to fetch Edge Function files");let g=y.response.headers.get("content-type");if(!g||!g.startsWith("multipart/form-data"))throw new Error(`Unexpected content type: ${g}. Expected multipart/form-data.`);let l=Q(g);if(!l)throw new Error("No multipart boundary found in response headers");if(!y.data)throw new Error("No data received from Edge Function body");let h=[],T=J(y.data,{boundary:l});for await(let b of T)b.isFile&&b.filename&&h.push({name:_({deploymentId:i,filename:b.filename}),content:b.text});return{...n,entrypoint_path:c,import_map_path:u,files:h}},async deployEdgeFunction(t,e){let{name:a,entrypoint_path:n,import_map_path:i,files:c}=M.parse(e),u;try{u=await S.getEdgeFunction(t,a)}catch{}let y=c.find(l=>["deno.json","import_map.json"].includes(l.name));i??=u?.import_map_path??y?.name;let g=await s.POST("/v1/projects/{ref}/functions/deploy",{params:{path:{ref:t},query:{slug:a}},body:{metadata:{name:a,entrypoint_path:n,import_map_path:i},file:c},bodySerializer(l){let h=new FormData,T=new Blob([JSON.stringify(l.metadata)],{type:"application/json"});return h.append("metadata",T),l.file?.forEach(b=>{let A=b,z=new Blob([A.content],{type:"application/typescript"});h.append("file",z,A.name)}),h}});return r(g,"Failed to deploy Edge Function"),g.data}};return{async init(t){let{clientInfo:e}=t;if(!e)throw new Error("Client info is required");s=P(w,o,{"User-Agent":`supabase-mcp/${V} (${e.name}/${e.version})`})},account:m,database:O,debugging:E,development:v,functions:S,branching:{async listBranches(t){let e=await s.GET("/v1/projects/{ref}/branches",{params:{path:{ref:t}}});return e.response.status===422?[]:(r(e,"Failed to list branches"),e.data)},async createBranch(t,e){let{name:a}=B.parse(e),n=await s.POST("/v1/projects/{ref}/branches",{params:{path:{ref:t}},body:{branch_name:a}});return r(n,"Failed to create branch"),n.data},async deleteBranch(t){let e=await s.DELETE("/v1/branches/{branch_id}",{params:{path:{branch_id:t}}});r(e,"Failed to delete branch")},async mergeBranch(t){let e=await s.POST("/v1/branches/{branch_id}/merge",{params:{path:{branch_id:t}},body:{}});r(e,"Failed to merge branch")},async resetBranch(t,e){let{migration_version:a}=x.parse(e),n=await s.POST("/v1/branches/{branch_id}/reset",{params:{path:{branch_id:t}},body:{migration_version:a}});r(n,"Failed to reset branch")},async rebaseBranch(t){let e=await s.POST("/v1/branches/{branch_id}/push",{params:{path:{branch_id:t}},body:{}});r(e,"Failed to rebase branch")}},storage:{async listAllBuckets(t){let e=await s.GET("/v1/projects/{ref}/storage/buckets",{params:{path:{ref:t}}});return r(e,"Failed to list storage buckets"),e.data},async getStorageConfig(t){let e=await s.GET("/v1/projects/{ref}/config/storage",{params:{path:{ref:t}}});return r(e,"Failed to get storage config"),e.data},async updateStorageConfig(t,e){let a=await s.PATCH("/v1/projects/{ref}/config/storage",{params:{path:{ref:t}},body:{fileSizeLimit:e.fileSizeLimit,features:{imageTransformation:{enabled:e.features.imageTransformation.enabled},s3Protocol:{enabled:e.features.s3Protocol.enabled}}}});return r(a,"Failed to update storage config"),a.data}}}}function Y(p){switch(p){case"api.supabase.com":return"supabase.co";case"api.supabase.green":return"supabase.green";default:return"supabase.red"}}export{fe as a};
//# sourceMappingURL=chunk-WTBF6S2A.js.map